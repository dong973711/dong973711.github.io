{"version":3,"sources":["ChildrenProtect.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/scripts/framework/common","sourcesContent":["const UtilsOther = require(\"UtilsOther\");\nconst { ccclass, property } = cc._decorator;\nconst KEY_GAME_T = 'game_util_';\nconst KEY_RECOVER_T = 'game_recover_';\n\n@ccclass\nexport default class ChildrenProtect extends cc.Component {\n    @property\n    limitTime: number = 15; // 限制游戏时间（分钟）\n\n    @property\n    restTime: number = 10; // 强制休息时间(分钟)\n\n    private _gameTime: number = -1;\n    private _recoverTime: number = -1;\n    private _enterBgTime: number = -1;\n    private _bgDuration: number = -1;\n\n    private _timeLabel: cc.Label = null;\n    private _blockNode: cc.Node = null;\n\n    private _onLimitCb: Function = null;\n    private _onRecoverCb: Function = null;\n\n    onLoad() {\n        let st = cc.sys.localStorage.getItem(KEY_GAME_T);\n        if (!st) {\n            st = UtilsOther.time();\n            cc.sys.localStorage.setItem(KEY_GAME_T, st);\n        }\n        this._gameTime = Number(st) + this.limitTime * 60;\n\n        let rt = cc.sys.localStorage.getItem(KEY_RECOVER_T);\n        if (!rt) {\n            rt = -1;\n            cc.sys.localStorage.setItem(KEY_RECOVER_T, rt);\n        }\n        this._recoverTime = Number(rt);\n\n        this.createBlockNode();\n\n        cc.game.on(cc.game.EVENT_HIDE, ()=>{\n            cc.log('on game hide');\n            cc.sys.localStorage.setItem(KEY_GAME_T, this._gameTime);\n            cc.sys.localStorage.setItem(KEY_RECOVER_T, this._recoverTime);\n            this._enterBgTime = UtilsOther.time();\n        });\n        cc.game.on(cc.game.EVENT_SHOW, ()=>{\n            cc.log('on game show');\n            this._bgDuration = this._enterBgTime > 0 ? UtilsOther.time() - this._enterBgTime : 0;\n            cc.log('在后台时间:', this._bgDuration);\n            if (!this._blockNode.active) {\n                this._gameTime += this._bgDuration;\n            }\n        });\n    }\n\n    setOnLimitCb(cb: Function) {\n        this._onLimitCb = cb;\n    }\n\n    setOnRecoverCb(cb: Function) {\n        this._onRecoverCb = cb;\n    }\n\n    private createBlockNode() {\n        let parent = cc.Canvas.instance.node;\n        let node = this._blockNode = new cc.Node('blockNode');\n        node.parent = parent;\n        node.zIndex = cc.macro.MAX_ZINDEX - 1;\n        node.addComponent(cc.BlockInputEvents);\n\n        let sp = node.addComponent(cc.Sprite);\n        cc.loader.load({uuid: '0275e94c-56a7-410f-bd1a-fc7483f7d14a'}, (err, tex)=>{\n            if (err) {\n                cc.log(err);\n                return;\n            }\n            sp.spriteFrame = new cc.SpriteFrame(tex);\n            node.width = parent.width;\n            node.height = parent.height;\n            node.color = cc.Color.GREEN;\n        });\n        \n        let labelNode = new cc.Node('time');\n        labelNode.parent = node;\n        let label = this._timeLabel = labelNode.addComponent(cc.Label);\n        label.fontSize = label.lineHeight = 60;\n        \n        let copy = cc.instantiate(labelNode);\n        label = copy.getComponent(cc.Label);\n        label.string = '看看窗外让眼睛休息一下吧~'\n        label.fontSize = label.lineHeight = 40;\n        copy.parent = node;\n        copy.y = 100;\n\n        node.active = false;\n    }\n\n    onEnable() {\n        this.schedule(this.updateLimit, 0.2, cc.macro.REPEAT_FOREVER, 0);;\n    }\n\n    onDisable() {\n        this.unschedule(this.updateLimit);\n    }\n\n    updateLimit(dt) {\n        let now = UtilsOther.time();\n        if (now < this._gameTime) {\n            cc.log('游戏中，还剩余:', this._gameTime - now);\n        } else {\n            if (this._recoverTime < 0) {\n                this._recoverTime = now + this.restTime * 60;\n                cc.sys.localStorage.setItem(KEY_RECOVER_T, this._recoverTime);\n            } else {\n                if (now <= this._recoverTime) {\n                    let remind = this._recoverTime - now;\n                    cc.log('休息中，还剩余:', remind);\n                    if (!this._blockNode.active) {\n                        this._blockNode.active = true;\n                        this._onLimitCb && this._onLimitCb();\n                    }\n                    this._timeLabel.string = UtilsOther.formatTime(remind);\n                } else {\n                    cc.log('恢复游戏');\n                    this._blockNode.active = false;\n                    this._onRecoverCb && this._onRecoverCb();\n                    this._gameTime = now + this.limitTime * 60;\n                    this._recoverTime = -1;\n                    cc.sys.localStorage.setItem(KEY_GAME_T, this._gameTime);\n                    cc.sys.localStorage.setItem(KEY_RECOVER_T, this._recoverTime);\n                }\n            }\n        }\n    }\n}"]}